<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/recole"></script>
</head>

<body>
    <style>
        table.calculator {
            background-color: #FFFFFF;
            margin: 0 auto;
            margin-top: 20px;
            margin-right: 10px;
            margin-left: 10px;
            margin-bottom: 40px;
            border-radius: 10px;
            background: #ececec;
            padding: 20px 10px 23px 10px;

        }

        .calculator td {
            width: 110px;
            height: 60px;
            text-align: center;
            font-size: xx-large;

        }

        .calculator #screen {
            text-align: right;
            padding: 0 13%;
        }

        .calculator .orange {
            color: #ff3300;
        }

        .calculator td:active {
            background-color: #e0e0d1;
            border-radius: 20px;
        }
    </style>
    <table class="calculator">
        <tbody>
            <tr>
                <td id="screen" colspan='3'>

                </td>
            </tr>
            <tr class="orange">
                <td class="reset">C</td>
                <td class="operator" data-value="%">%</td>
                <td class="operator" data-value="/">/</td>
            </tr>
            <tr class="orange">
                <td class="operator" data-value="+">+</td>
                <td class="operator" data-value="-">-</td>
                <td class="operator" data-value="x">x</td>
            </tr>
            <tr>
                <td class="number" data-value="7">7</td>
                <td class="number" data-value="8">8</td>
                <td class="number" data-value="9">9</td>
            </tr>
            <tr>
                <td class="number" data-value="4">4</td>
                <td class="number" data-value="5">5</td>
                <td class="number" data-value="6">6</td>
            </tr>
            <tr>
                <td class="number" data-value="1">1</td>
                <td class="number" data-value="2">2</td>
                <td class="number" data-value="3">3</td>
            </tr>
            <tr>
                <td class="dot">.</td>
                <td class="number" data-value="3">0</td>
                <td class="equal">=</td>
            </tr>
        </tbody>
    </table>
    <style>
        .SnakeGame td {
            width: 10px;
            height: 10px;
            background: #202124;
        }

        .SnakeGame td.active {
            background: green;
        }

        .SnakeGame td.active2 {
            background: blue;
        }

        .SnakeGame-control tr {
            color: #202124;
            width: 22px;
            height: 22px;
        }

        .SnakeGame-control td {
            width: 30px;
            height: 30px;
        }

        .SnakeGame-control #up,
        .SnakeGame-control #right,
        .SnakeGame-control #down,
        .SnakeGame-control #left {
            cursor: pointer;
        }

        .SnakeGame-control #up:hover,
        .SnakeGame-control #right:hover,
        .SnakeGame-control #down:hover,
        .SnakeGame-control #left:hover {
            font-size: 1.2em;
        }
    </style>
    <table class="SnakeGame">
        <tbody>
            <tr data-cord="0">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="1">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="2">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="3">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="4">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="5">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
            <tr data-cord="6">
                <td data-cord="0">

                </td>
                <td data-cord="1">

                </td>
                <td data-cord="2">

                </td>
                <td data-cord="3">

                </td>
                <td data-cord="4">

                </td>
                <td data-cord="5">

                </td>
                <td data-cord="6">

                </td>
            </tr>
        </tbody>
    </table>
    <table class="SnakeGame-control">
        <tbody>
            <tr>
                <td></td>
                <td id="up">↑</td>
                <td></td>
            </tr>
            <tr>
                <td id="left">←</td>
                <td id="down">↓</td>
                <td id="right">→</td>
            </tr>
        </tbody>
    </table>
    <script>
        let recole1 = new recole()

        //demo test case 1:  calculator demo 
        let calculatorState = recole1.createReactive({
            operandA: 0,
            operandB: 0,
            operator: null,
            procedureState: 0
        })
        let screenStr = recole1.computed(() => {
            console.log(calculatorState.procedureState)
            let rtn = ""
            if (calculatorState.procedureState == 0) {// expecting operandA
                rtn = calculatorState.operandA
            } else if (calculatorState.procedureState == 1) { // expecting operandA floating number
                rtn = calculatorState.operandA
            } else if (calculatorState.procedureState == 2) { // expecting operandB
                rtn = calculatorState.operandA
            } else if (calculatorState.procedureState == 3) { // expecting operandA floating number
                rtn = calculatorState.operandA
            } else if (calculatorState.procedureState == 4) {
                rtn = calculatorState.operandB
            } else if (calculatorState.procedureState == 5) {
                switch (calculatorState.operator) {
                    case "+":
                        rtn = (+calculatorState.operandA) + (+calculatorState.operandB)
                        break;
                    case "-":
                        rtn = (+calculatorState.operandA) - (+calculatorState.operandB)
                        break;
                    case "x":
                        rtn = (+calculatorState.operandA) * (+calculatorState.operandB)
                        break;
                    case "/":
                        rtn = (+calculatorState.operandA) / (+calculatorState.operandB)
                        break;
                    case "%":
                        rtn = (+calculatorState.operandA) % (+calculatorState.operandB)
                        break;
                }
            }
            return rtn
        })
        recole1.watch(screenStr, () => {
            document.querySelector("#screen").innerHTML = screenStr.value
        })
        document.querySelectorAll(".calculator .number").forEach((el) => {
            el.addEventListener("click", () => {
                if (calculatorState.procedureState == 0) {
                    calculatorState.operandA = el.dataset.value
                } else if (calculatorState.procedureState == 1) {

                    calculatorState.operandA = calculatorState.operandA.toString() + el.dataset.value
                } else if (calculatorState.procedureState == 2) {
                    calculatorState.operandB = el.dataset.value
                    calculatorState.procedureState = 4
                } else if (calculatorState.procedureState == 3) {

                }
            })
        })
        document.querySelectorAll(".calculator .operator").forEach((el) => {
            el.addEventListener("click", () => {
                if (calculatorState.procedureState == 0 || calculatorState.procedureState == 1) {
                    calculatorState.procedureState = 2
                    calculatorState.operator = el.dataset.value
                } else if (calculatorState.procedureState == 2) {
                    calculatorState.operator = el.dataset.value
                }
            })
        })
        document.querySelector(".calculator .equal").addEventListener("click", (el) => {
            calculatorState.procedureState = 5
        })
        document.querySelector(".calculator .dot").addEventListener("click", (el) => {
            if (calculatorState.procedureState == 0) {
                calculatorState.operandA = calculatorState.operandA.toString() + "."
                calculatorState.procedureState += 1
            } else if (calculatorState.procedureState == 2) {
                calculatorState.operandB = calculatorState.operandB.toString() + "."
                calculatorState.procedureState += 1
            }
        })
        document.querySelector(".calculator .reset").addEventListener("click", (el) => {
            calculatorState.operandA = 0
            calculatorState.operandB = 0
            calculatorState.procedureState = 0
        })




        //demo test case 2:  Snake demo 
        console.log("demo test case 2")

        let direction = recole1.ref("")

        let block1 = recole1.createReactive({ x: 1, y: 4 })
        let block2 = recole1.createReactive({ x: 0, y: 4 })
        let block3 = recole1.createReactive({ x: 0, y: 3 })
        let block4 = recole1.createReactive({ x: 0, y: 2 })
        let block5 = recole1.createReactive({ x: 0, y: 1 })

        let blockSet = new Set();


        let removeCurrent = function (block) {
            document
                .querySelector(`.SnakeGame tr[data-cord='${block.y}']`)
                .querySelector(`td[data-cord='${block.x}']`)
                .classList.remove("active")
        }
        recole1.watch(block1,
            () => {
                document
                    .querySelector(`.SnakeGame tr[data-cord='${block1.y}']`)
                    .querySelector(`td[data-cord='${block1.x}']`)
                    .classList.add("active")

                if (Array.from(blockSet).map(x => JSON.stringify(x)).indexOf(JSON.stringify({ x: block1.x, y: block1.y })) != -1) { //check dead
                    console.log("dead")
                }
                blockSet.clear()
            },
            () => {
                console.log("move start")

                removeCurrent(block1)

                block2.x = block1.x
                block2.y = block1.y

            }
        )
        recole1.watch(block2,
            () => {
                document
                    .querySelector(`.SnakeGame tr[data-cord='${block2.y}']`)
                    .querySelector(`td[data-cord='${block2.x}']`)
                    .classList.add("active")
            },
            () => {
                removeCurrent(block2)

                blockSet.add({ x: block2.x, y: block2.y })

                block3.x = block2.x
                block3.y = block2.y
            }
        )
        recole1.watch(block3, () => {
            document
                .querySelector(`.SnakeGame tr[data-cord='${block3.y}']`)
                .querySelector(`td[data-cord='${block3.x}']`)
                .classList.add("active")
        },
            () => {
                removeCurrent(block3)

                blockSet.add({ x: block3.x, y: block3.y })

                block4.x = block3.x
                block4.y = block3.y
            }
        )
        recole1.watch(block4, () => {
            document
                .querySelector(`.SnakeGame tr[data-cord='${block4.y}']`)
                .querySelector(`td[data-cord='${block4.x}']`)
                .classList.add("active")
        },
            () => {
                removeCurrent(block4)

                blockSet.add({ x: block4.x, y: block4.y })

                block5.x = block4.x
                block5.y = block4.y
            }
        )
        recole1.watch(block5, () => {
            document
                .querySelector(`.SnakeGame tr[data-cord='${block5.y}']`)
                .querySelector(`td[data-cord='${block5.x}']`)
                .classList.add("active")
        },
            () => {
                removeCurrent(block5)

                blockSet.add({ x: block5.x, y: block5.y })
                console.log(blockSet)
            }
        )

        document.querySelector(".SnakeGame-control #up").addEventListener("click", () => {
            if (direction.value == "down") return

            let vv = (block1.y - 1) % 7
            if (vv < 0) vv += 7
            block1.y = vv

            direction.value = "up"
        })
        document.querySelector(".SnakeGame-control #right").addEventListener("click", () => {
            if (direction.value == "left") return

            let vv = (block1.x + 1) % 7
            if (vv < 0) vv += 7
            block1.x = vv

            direction.value = "right"
        })
        document.querySelector(".SnakeGame-control #down").addEventListener("click", () => {
            if (direction.value == "up") return

            let vv = (block1.y + 1) % 7
            if (vv < 0) vv += 7
            block1.y = vv

            direction.value = "down"
        })
        document.querySelector(".SnakeGame-control #left").addEventListener("click", () => {
            if (direction.value == "right") return

            let vv = (block1.x - 1) % 7
            if (vv < 0) vv += 7
            block1.x = vv

            direction.value = "left"
        })


    </script>
</body>

</html>